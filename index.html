<!DOCTYPE html><html lang="ru"><head><meta charset="utf-8" /><meta name="author" content="NU London" /><title>Object-Oriented Design Patterns</title><meta content="yes" name="apple-mobile-web-app-capable" /><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style" /><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport" /><link href="reveal.js-3.7.0/css/reveal.css" rel="stylesheet" /><link rel="stylesheet" href="white_course.css" id="theme" /><!--This CSS is generated by the Asciidoctor-Reveal.js converter to further integrate AsciiDoc's existing semantic with Reveal.js--><style type="text/css">.reveal div.right {
  float: right;
}

/* callouts */
.conum[data-value] {display:inline-block;color:#fff!important;background-color:rgba(50,150,50,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}</style><link rel="stylesheet" href="./font-awesome-4.7.0/css/font-awesome.css" /><script type="text/x-mathjax-config">MathJax.Hub.Config({
tex2jax: {
  inlineMath: [["\\(", "\\)"]],
  displayMath: [["\\[", "\\]"]],
  ignoreClass: "nostem|nolatexmath"
},
asciimath2jax: {
  delimiters: [["\\$", "\\$"]],
  ignoreClass: "nostem|noasciimath"
},
TeX: { equationNumbers: { autoNumber: "none" } }
});</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.4.0/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script><style>/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}</style><link href="reveal.js-3.7.0/lib/css/zenburn.css" rel="stylesheet" /><script>var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? "reveal.js-3.7.0/css/print/pdf.css" : "reveal.js-3.7.0/css/print/paper.css";
document.getElementsByTagName( 'head' )[0].appendChild( link );</script><!--[if lt IE 9]><script src="reveal.js-3.7.0/lib/js/html5shiv.js"></script><![endif]--></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title"><h1>Object-Oriented Design Patterns</h1><p class="author"><small>NU London</small></p></section><section id="_why_do_we_need_design_patterns"><h2>Why do we need design patterns?</h2><div class="ulist"><ul><li><p>We&#8217;re facing the same problems over and over again while designing the software</p></li><li><p>There are "standard" good solutions used in numerous projects</p></li><li><p>These solutions have specific names which makes communication easier<br />
(e.g. "<em>I used Delegate pattern in order to get the value for this property</em>")</p></li></ul></div></section>
<section id="_the_classical_book"><h2>The Classical Book</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:30%" /><col style="width:70%" /></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><div><div class="imageblock" style=""><img src="images/gof.jpg" alt="gof" /></div></div></td><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p><strong>Erich Gamma et al.</strong>, Design Patterns: Elements of Reusable Object-Oriented Software</p></li><li><p>Published in 1994</p></li><li><p>A classical book on software design (although partially outdated)</p></li><li><p>Patterns from this book are referred to as <em>GoF patterns</em> ("Gang of Four" is 4 authors of this book).</p></li></ul></div></div></td></tr></table></section>
<section id="_some_other_sources"><h2>Some other sources</h2><div class="paragraph"><p>Free online references (mostly GoF patterns reiterated):</p></div>
<div class="ulist"><ul><li><p><a href="https://www.oodesign.com/" class="bare">https://www.oodesign.com/</a></p></li><li><p><a href="https://refactoring.guru/design-patterns" class="bare">https://refactoring.guru/design-patterns</a></p></li><li><p><strong>Wikipedia</strong> has an extensive list and a dedicated article on most of design patterns (<a href="https://en.wikipedia.org/wiki/Software_design_pattern" class="bare">https://en.wikipedia.org/wiki/Software_design_pattern</a>)</p></li></ul></div></section>
<section id="_types_of_design_patterns"><h2>Types of design patterns</h2><div class="ulist"><ul><li><p><strong>Creational patterns</strong> &#8201;&#8212;&#8201;various object creation mechanisms, which increase flexibility and reuse of existing code</p></li><li><p><strong>Structural patterns</strong>&#8201;&#8212;&#8201;focus on how to assemble objects and classes into larger structures, while keeping these structures flexible and efficient.</p></li><li><p><strong>Behavioural patterns</strong>&#8201;&#8212;&#8201;concerned with algorithms and the assignment of responsibilities between objects.</p></li></ul></div></section>
<section id="_what_we_will_cover"><h2>What we will cover</h2><div class="ulist"><ul><li><p>In total, there are about 30 design patterns, but not all of them are equally frequently used.</p></li><li><p><strong>Singleton</strong> GoF design pattern is now considered to be an <strong>antipattern</strong> because of its difficulty to test. Currently, superceded by Dependency Injection frameworks (e.g. Spring in Java).</p></li><li><p>We will cover only some basic patterns and those that will be useful for your homework assignment.</p></li></ul></div></section>
<section id="_superobject_antipattern"><h2>Superobject antipattern</h2><div class="imageblock" style=""><img src="images/diag-aa912d7680456dbc0aa4f298af480458.png" alt="diag aa912d7680456dbc0aa4f298af480458" /></div></section>
<section id="_composite_divide_and_conquer"><h2>Composite: Divide and conquer!</h2><div class="paragraph"><p>A tree of objects: a hierarchy of objects with distributed responsibilities</p></div>
<div class="imageblock" style=""><img src="images/diag-7b431cca8aa9faef123b6231f3936a8e.png" alt="diag 7b431cca8aa9faef123b6231f3936a8e" /></div></section>
<section id="_composite_divide_and_conquer_2"><h2>Composite: Divide and conquer!</h2><div class="paragraph"><p>A directed acyclic graph  (DAG) of objects: more generic case!</p></div>
<div class="imageblock" style=""><img src="images/diag-f87276e0417d72bdac3c78610a9fc0db.png" alt="diag f87276e0417d72bdac3c78610a9fc0db" /></div></section>
<section id="_a_classic_example"><h2>A classic example</h2><div class="paragraph"><p>Imagine we need to draw the following picture (a UML use case diagram):</p></div>
<div class="imageblock" style=""><img src="images/diag-14675fbc670e028f614e527c00c74415.png" alt="diag 14675fbc670e028f614e527c00c74415" /></div>
<div class="paragraph"><p>We need classes <code>Actor</code>, <code>UseCase</code> and <code>Arrow</code>,<br />
and have to make them to be the components of <code>Diagram</code></p></div></section>
<section id="_a_classic_example_2"><h2>A classic example</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%" /><col style="width:50%" /></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><div><div class="imageblock" style=""><img src="images/diag-14675fbc670e028f614e527c00c74415.png" alt="diag 14675fbc670e028f614e527c00c74415" /></div></div></td><td class="tableblock halign-center valign-top"><div><div class="imageblock" style=""><img src="images/diag-682407ba0a4003f62cdc6a555d5743f2.png" alt="diag 682407ba0a4003f62cdc6a555d5743f2" /></div></div></td></tr></table></section>
<section id="_draw_method_of_a_diagram"><h2><code>Draw</code> method of a diagram</h2><div class="imageblock" style=""><img src="images/diag-2b68a3948f2943f0abfabb972743e0cb.png" alt="diag 2b68a3948f2943f0abfabb972743e0cb" /></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="type">class</span> <span class="class">Diagram</span> <span class="directive">implements</span> <span class="predefined-type">Element</span> {
    <span class="type">void</span> draw() {
        <span class="keyword">for</span> (<span class="predefined-type">Element</span> e: elements) {
            e.draw();
        }
    }
}</code></pre></section>
<section id="_a_generic_decomposition_of_a_typical_application"><h2>A generic decomposition of a typical application</h2><div class="paragraph"><p>A generic "layered" architecture of a typical Java application</p></div>
<div class="imageblock" style=""><img src="images/layers.png" alt="layers" /></div></section>
<section id="_your_own_application_from_project_1_2"><h2>Your own application from Project 1 &amp; 2</h2><div class="imageblock" style=""><img src="images/diag-e6f236616672e21b8b0dab21ae21fd76.png" alt="diag e6f236616672e21b8b0dab21ae21fd76" /></div></section>
<section id="_composite_takeaways"><h2>Composite takeaways</h2><div class="olist arabic"><ol class="arabic"><li><p>Avoid creating huge "superobjects"</p></li><li><p>Remember: Divide and conquer!</p></li><li><p>When your components implement the same interface, you can command them to do perform the same action at once (e. g. "draw me a diagram").</p></li></ol></div></section>
<section id="_now_lets_consider_the_following_example"><h2>Now let&#8217;s consider the following example</h2><div class="imageblock" style=""><img src="images/png.png" alt="png" /></div></section>
<section id="_a_naïve_approach_let_the_objects_create_what_they_need_themselves"><h2>A naïve approach: "Let the objects create what they need themselves"</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:30%" /><col style="width:70%" /></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><div><div class="imageblock" style=""><img src="images/png.png" alt="png" /></div></div></td><td class="tableblock halign-left valign-top"><div><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">A</span> {
  <span class="directive">private</span> <span class="directive">final</span> B b = <span class="keyword">new</span> B();
  <span class="directive">private</span> <span class="directive">final</span> C c = <span class="keyword">new</span> C();
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">B</span> {
  <span class="directive">private</span> <span class="directive">final</span> D d = <span class="keyword">new</span> D();
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">C</span> {
  <span class="directive">private</span> <span class="directive">final</span> D d = ???; <span class="comment">//OOPS!</span>
}</code></pre>
<div class="paragraph"><p>It is impossible to make a single instance of <code>D</code><br />
shared between <code>B</code> and <code>C</code>!</p></div></div></td></tr></table></section>
<section id="_how_do_we_test"><h2>How do we test?</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:30%" /><col style="width:70%" /></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><div><div class="imageblock" style=""><img src="images/png.png" alt="png" /></div></div></td><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p>If <code>A</code> creates <code>B</code> and <code>C</code>, how can we test <code>A</code> separately?</p></li><li><p>How do we substitute <code>B</code> and <code>C</code> with mock implementations?</p></li><li><p>This is impossible if we do it like this:</p></li></ul></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">A</span> {
  <span class="directive">private</span> <span class="directive">final</span> B b = <span class="keyword">new</span> B(...);
  <span class="directive">private</span> <span class="directive">final</span> C c = <span class="keyword">new</span> C(...);
}</code></pre></div></td></tr></table></section>
<section id="_lets_make_external_dependencies_pluggable"><h2>Let&#8217;s make external dependencies "pluggable"</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:30%" /><col style="width:70%" /></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><div><div class="imageblock" style=""><img src="images/png.png" alt="png" /></div></div></td><td class="tableblock halign-left valign-top"><div><pre class="CodeRay listingblock"><code class="java language-java"><span class="type">class</span> <span class="class">A</span> {
  <span class="directive">private</span> <span class="directive">final</span> B b;
  <span class="directive">private</span> <span class="directive">final</span> C C;
  <span class="directive">public</span> A(B b, C c) {
      <span class="local-variable">this</span>.b = b;
      <span class="local-variable">this</span>.c = c; }}

<span class="type">class</span> <span class="class">B</span> {
    <span class="directive">private</span> <span class="directive">final</span> D d;
    <span class="directive">public</span> B(D d){
        <span class="local-variable">this</span>.d = d; }}

<span class="type">class</span> <span class="class">C</span> {
    <span class="directive">private</span> <span class="directive">final</span> D d;
    <span class="directive">public</span> C(D d){
        <span class="local-variable">this</span>.d = d; }}</code></pre></div></td></tr></table></section>
<section id="_now_testing_is_possible"><h2>Now testing is possible!</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="type">class</span> <span class="class">ATest</span> {
    <span class="comment">//Use mocks instead of &quot;real&quot; dependencies</span>
    A objectUnderTest = <span class="keyword">new</span> A(
            Mockito.mock(B.class),
            Mockito.mock(C.class)
    );


    <span class="annotation">@Test</span>
    <span class="comment">// setup mocks and test as needed</span>
}</code></pre></section>
<section id="_factory_method"><h2>Factory Method</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:30%" /><col style="width:70%" /></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><div><div class="imageblock" style=""><img src="images/png.png" alt="png" /></div></div></td><td class="tableblock halign-left valign-top"><div><pre class="CodeRay listingblock"><code class="java language-java"><span class="comment">/*Move all the &quot;wiring&quot; from classes
to the factory method*/</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ApplicationFactory</span> {

  <span class="directive">public</span> <span class="directive">static</span> A createA() {
     D d = <span class="keyword">new</span> D();
     B b = <span class="keyword">new</span> B(d);
     C c = <span class="keyword">new</span> C(d);
     A a = <span class="keyword">new</span> A(b,c);
     <span class="keyword">return</span> a;
  }
}</code></pre></div></td></tr></table></section>
<section id="_how_its_done_in_di_dependency_injection_frameworks"><h2>How it&#8217;s done in DI ("dependency injection") frameworks</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:30%" /><col style="width:70%" /></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><div><div class="imageblock" style=""><img src="images/png.png" alt="png" /></div></div></td><td class="tableblock halign-left valign-top"><div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Component</span>
<span class="type">class</span> <span class="class">A</span> {
  <span class="directive">private</span> <span class="directive">final</span> B b;
  <span class="directive">private</span> <span class="directive">final</span> C C;
  <span class="directive">public</span> A(B b, C c) { <span class="local-variable">this</span>.b = b; <span class="local-variable">this</span>.c = c; }}

<span class="annotation">@Component</span>
<span class="type">class</span> <span class="class">B</span> {
  <span class="directive">private</span> <span class="directive">final</span> D d;
  <span class="directive">public</span> B(D d) { <span class="local-variable">this</span>.d = d; }}

<span class="annotation">@Component</span>
<span class="type">class</span> <span class="class">C</span> {
  <span class="directive">private</span> <span class="directive">final</span> D d;
  <span class="directive">public</span> C(D d) { <span class="local-variable">this</span>.d = d; }}

A a = context.getBean(A.class);</code></pre></div></td></tr></table></section>
<section id="_factory_method_takeaways"><h2>Factory method takeaways</h2><div class="olist arabic"><ol class="arabic"><li><p>Do not make your classes responsible for creation of their dependencies. Let Factory Method do this job for them!</p></li><li><p>Define dependencies as constructor parameters, save them in class member variables.</p></li><li><p>This approach facilitates unit testing.</p></li><li><p>Dependency Injection (DI) frameworks, such as Spring, provide automatic factory methods.</p></li></ol></div></section>
<section id="_strategy_incapsulating_a_behaviour_into_an_object"><h2>Strategy: incapsulating a behaviour into an object</h2><div class="imageblock" style=""><img src="images/strategy.png" alt="strategy" /></div></section>
<section id="_in_java_strategy_is_often_a_lambda_or_a_method_reference"><h2>In Java, Strategy is often a lambda or a method reference</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="type">class</span> <span class="class">Calculator</span> {
    <span class="directive">private</span> <span class="directive">final</span> Function&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; taxStrategy;
    Calculator(Function&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; taxCalculationStrategy) {
        <span class="local-variable">this</span>.taxStrategy = taxCalculationStrategy;
    }
    <span class="predefined-type">Integer</span> calculate(<span class="predefined-type">Integer</span> amount) {
        <span class="predefined-type">Integer</span> surcharged = amount + <span class="integer">15</span>;
        <span class="keyword">return</span> surcharged + taxStrategy.apply(surcharged);
    }
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        <span class="predefined-type">System</span>.out.println(<span class="keyword">new</span> Calculator(
                <span class="comment">//Flat 20% strategy</span>
                amount -&gt; amount / <span class="integer">5</span>
        ).calculate(<span class="integer">100</span>));
    }
}</code></pre></section>
<section id="_comparator_another_example_of_a_strategy"><h2>Comparator: another example of a strategy</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="predefined-type">Collections</span>.sort(people,
  <span class="predefined-type">Comparator</span>
    .comparing(Person::getLastName)
    .thenComparing(Person::getFirstName));
);</code></pre></section>
<section id="_strategy_takeaways"><h2>Strategy takeaways</h2><div class="olist arabic"><ol class="arabic"><li><p>In object-oriented programming, an object not only encapsulates data: it can encapsulate behaviour as well!</p></li><li><p>You can pass a Strategy as a parameter to a method or a generic algorithm.</p></li><li><p>Lambdas and method references are syntactic constructions that make it easy to define strategies which consist of a single method only.</p></li></ol></div></section>
<section id="_command_undo_and_redo"><h2>Command: Undo and Redo</h2><div class="imageblock" style=""><img src="images/undoredo.png" alt="undoredo" /></div><div class="title">Undo and Redo stacks of commands</div></section>
<section id="_command_interface"><h2>Command interface</h2><div class="imageblock" style=""><img src="images/diag-94d0b596d06a02c66c656e1e4b69a541.png" alt="diag 94d0b596d06a02c66c656e1e4b69a541" /></div></section>
<section id="_command_takeaways"><h2>Command takeaways</h2><div class="olist arabic"><ol class="arabic"><li><p>Command object incapsulates the fact of invocation of some methods with some parameters.</p></li><li><p>Using Command patterns, we can log user actions (e. g. for audit purposes or for replication of user actions across a distributed system), and implement Undo/Redo functionality.</p></li></ol></div></section>
<section id="_visitor_pattern_a_practical_problem"><h2>Visitor Pattern: A Practical Problem</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%" /><col style="width:50%" /></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>TAKE&#8230;&#8203;</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>&#8230;&#8203;TRANSFORM INTO</p></div></div></td></tr><tr><td class="tableblock halign-left valign-middle"><div><div class="imageblock" style=""><img src="images/something.png.png" alt="something.png" /></div></div></td><td class="tableblock halign-left valign-middle"><div><div class="ulist"><ul><li><p>Code</p></li><li><p>Text</p></li><li><p>Visual representation</p></li><li><p>Result of calculation (number, vector, matrix&#8230;&#8203;)</p></li></ul></div></div></td></tr></table></section>
<section id="_a_very_important_specific_case"><h2>A very important specific case</h2><div class="ulist"><ul><li><p>Take AST (abstract synthax tree) of parsed code and</p><div class="ulist"><ul><li><p><strong>verify</strong> the correctness of code (e. g. that all the variables are defined and all the types are compatible)</p></li><li><p><strong>compile</strong> it into machine code</p></li><li><p><strong>execute</strong> (interpret) the code without compilation</p></li></ul></div></li></ul></div></section>
<section id="_naive_approach_add_methods_to_the_class"><h2>Naive approach: add methods to the class?</h2><pre class="CodeRay listingblock"><code class="java language-java">Program program = Program.parse(....);
<span class="comment">//These are methods of class Program</span>
program.verify();
program.compile();
program.execute();</code></pre>
<div class="paragraph"><p>Drawback: too many responsibilities for <code>Program</code> class. Impossible to maintain and extend.</p></div></section>
<section id="_separation_of_responisibilities_visitor_pattern"><h2>Separation of responisibilities: Visitor pattern</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%" /><col style="width:50%" /></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>Data Structure</strong></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>Visitor</strong></p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p>Keeps the data.</p></li><li><p>"Knows" how to traverse the data.</p></li><li><p>"Navigates" the visitor.</p></li></ul></div></div></td><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p>"Knows" how to transform the data.</p></li><li><p>Each visitor is responsible for one kind of transformations only, but we can define as many visitors as needed.</p></li></ul></div></div></td></tr></table></section>
<section id="_classes_and_their_methods"><h2>Classes and their methods</h2><div class="imageblock" style=""><img src="images/diag-2416d56a2110d2112def00671c08122b.png" alt="diag 2416d56a2110d2112def00671c08122b" /></div></section>
<section id="_order_of_calling"><h2>Order of calling</h2><div class="imageblock" style=""><img src="images/diag-d4646fa58a49ec0a7c96f483ce998c9a.png" alt="diag d4646fa58a49ec0a7c96f483ce998c9a" /></div></section>
<section id="_what_is_the_simplest_visitor_pattern_implementation"><h2>What is the simplest visitor pattern implementation?</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="comment">//This is the data structure</span>
<span class="predefined-type">Collection</span>&lt;T&gt; collection = ...;

<span class="comment">//Consumer&lt;? super T&gt; parameter is the visitor</span>
collection.forEach (element -&gt; {
  <span class="comment">//do anything with each element</span>
})</code></pre>
<div class="ulist"><ul><li><p><code>accept(Visitor)</code> is <code>forEach(Consumer)</code></p></li><li><p>lambda (as an object) is the Visitor</p></li><li><p>lambda&#8217;s method is the Visitor&#8217;s <code>visit</code></p></li></ul></div></section>
<section id="_example_lets_implement_a_simple_language"><h2>Example: Let&#8217;s implement a simple language</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:40%" /><col style="width:60%" /></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><div><div class="imageblock" style=""><img src="images/calculator.jpg" alt="calculator" /></div></div></td><td class="tableblock halign-left valign-top"><div><div class="dlist"><dl><dt class="hdlist1">PrimaryTerm</dt><dd><div class="ulist"><ul><li><p>variable</p></li><li><p>numeric literal</p></li></ul></div></dd><dt class="hdlist1">UnaryOperation</dt><dd><div class="ulist"><ul><li><p>unary -</p></li><li><p>square root (<code>sqrt</code>)</p></li></ul></div></dd><dt class="hdlist1">BinaryOperation</dt><dd><div class="ulist"><ul><li><p>+, - (lower precedence)</p></li><li><p>*, / (higher precedence)</p></li></ul></div></dd><dt class="hdlist1">Parentheses</dt><dd><div class="ulist"><ul><li><p>(, )</p></li></ul></div></dd></dl></div></div></td></tr></table></section>
<section id="_quadratic_equation_root_formula"><h2>Quadratic equation root formula</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%" /><col style="width:50%" /></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><div><div class="stemblock"><div class="content">\[\huge
\frac {-b - \sqrt {b^2- 4ac}} {2 a}\]</div></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>In our "language":</p></div>
<pre class="CodeRay listingblock"><code>(-b - sqrt(b * b - 4 * a * c)) / (2 * a)</code></pre></div></td></tr></table></section>
<section id="_lets_do_two_things"><h2>Let&#8217;s do two things</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%" /><col style="width:50%" /></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Visualize</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Calculate</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="imageblock" style=""><img src="images/diag-dd20dc8e802a2b8af8e9e56d36d47665.png" alt="diag dd20dc8e802a2b8af8e9e56d36d47665" /></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Let&#8217;s solve</p></div>
<div class="paragraph"><p>\(x^2 + 2024x + 2023 = 0\)</p></div>
<div class="paragraph"><p>(Evaluate the formula for
\(a = 1, b = 2024, c = 2023\)).</p></div></div></td></tr></table></section>
<section id="_evaluating_the_formula"><h2>Evaluating the formula</h2><div class="stemblock"><div class="content">\[\huge
\sqrt{9} + 1\]</div></div>
<table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%" /><col style="width:50%" /></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><div><div class="imageblock" style=""><img src="images/diag-43eb977dcf172e7b895cc66c3c3eb4e0.png" alt="diag 43eb977dcf172e7b895cc66c3c3eb4e0" /></div></div></td><td class="tableblock halign-left valign-top"><div><div class="imageblock" style=""><img src="images/diag-7bb2deb27c7b1b644d0d401c5aa5fe6d.png" alt="diag 7bb2deb27c7b1b644d0d401c5aa5fe6d" /></div></div></td></tr></table></section>
<section id="_evaluating_the_formula_2"><h2>Evaluating the formula</h2><div class="stemblock"><div class="content">\[\huge
\sqrt{9} + 1\]</div></div>
<table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%" /><col style="width:50%" /></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><div><div class="imageblock" style=""><img src="images/diag-1a9b78f8b9b1afdf0f55a048b4065e9e.png" alt="diag 1a9b78f8b9b1afdf0f55a048b4065e9e" /></div></div></td><td class="tableblock halign-left valign-top"><div><div class="imageblock" style=""><img src="images/diag-cbcdf00ad3e0290c93292dc57cc13154.png" alt="diag cbcdf00ad3e0290c93292dc57cc13154" /></div></div></td></tr></table></section>
<section id="_evaluating_the_formula_3"><h2>Evaluating the formula</h2><div class="stemblock"><div class="content">\[\huge
\sqrt{9} + 1\]</div></div>
<table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%" /><col style="width:50%" /></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><div><div class="imageblock" style=""><img src="images/diag-1a9b78f8b9b1afdf0f55a048b4065e9e.png" alt="diag 1a9b78f8b9b1afdf0f55a048b4065e9e" /></div></div></td><td class="tableblock halign-left valign-top"><div><div class="imageblock" style=""><img src="images/diag-cbcdf00ad3e0290c93292dc57cc13154.png" alt="diag cbcdf00ad3e0290c93292dc57cc13154" /></div></div></td></tr></table></section>
<section id="_evaluating_the_formula_4"><h2>Evaluating the formula</h2><div class="stemblock"><div class="content">\[\huge
\sqrt{9} + 1\]</div></div>
<table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%" /><col style="width:50%" /></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><div><div class="imageblock" style=""><img src="images/diag-7dfa41b66a87e899941f372ac5f54204.png" alt="diag 7dfa41b66a87e899941f372ac5f54204" /></div></div></td><td class="tableblock halign-left valign-top"><div><div class="imageblock" style=""><img src="images/diag-4b65b63a15cc727fd4f92737026a8c0b.png" alt="diag 4b65b63a15cc727fd4f92737026a8c0b" /></div></div></td></tr></table></section>
<section id="_evaluating_the_formula_5"><h2>Evaluating the formula</h2><div class="stemblock"><div class="content">\[\huge
\sqrt{9} + 1\]</div></div>
<table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%" /><col style="width:50%" /></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><div><div class="imageblock" style=""><img src="images/diag-0446379254b687867a56e19e36ceeedd.png" alt="diag 0446379254b687867a56e19e36ceeedd" /></div></div></td><td class="tableblock halign-left valign-top"><div><div class="imageblock" style=""><img src="images/diag-80f9fe376309583d4fd9fa4368527410.png" alt="diag 80f9fe376309583d4fd9fa4368527410" /></div></div></td></tr></table></section>
<section id="_warning"><h2>Warning</h2><div class="ulist"><ul><li><p>Do not use pattern matching outside of visitor pattern (as a substitute of polymorphism)</p></li></ul></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="comment">/* It is better to have an abstract draw() method on Element class */</span>
<span class="keyword">switch</span> (element) {
    <span class="keyword">case</span> Actor actor -&gt; drawActor(actor);
    <span class="keyword">case</span> Arrow arrow -&gt; drawArrow(arrow);
    <span class="keyword">case</span> UseCase useCase -&gt; drawUseCase(useCase);
}</code></pre></section>
<section id="_takeaways_for_visitor"><h2>Takeaways (for Visitor)</h2><div class="ulist"><ul><li class="fragment"><p>Visitor pattern separates responsibilities between data structure and processor (visitor).</p></li><li class="fragment"><p>Data structure implements <code>accept(Visitor)</code>, visitor implements <code>visit(Element)</code>.</p></li><li class="fragment"><p>Depth-first traversal utilizing recursive calls on each of the elements of data structure is a common way to implement the pattern on the data structure side.</p></li><li class="fragment"><p>There can be multiple visitors implemented for different tasks.</p></li></ul></div></section></div></div><script src="reveal.js-3.7.0/lib/js/head.min.js"></script><script src="reveal.js-3.7.0/js/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
})

// See https://github.com/hakimel/reveal.js#configuration for a full list of configuration options
Reveal.initialize({
  // Display presentation control arrows
  controls: true,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'bottom-right',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: true,
  // Control which views the slide number displays on
  showSlideNumber: 'all',
  // Push each slide change to the browser history
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: false,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: false,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 120,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'none',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 1600,
  height: 900,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal.js-3.7.0/lib/js/classList.js', condition: function() { return !document.body.classList; } },
      
      { src: 'reveal.js-3.7.0/plugin/zoom-js/zoom.js', async: true },
      { src: 'reveal.js-3.7.0/plugin/notes/notes.js', async: true },
      
      
      
      
  ],

  

});</script></body></html>